@page "/"
@using System.Net.Http
@using System.Net.Http.Json
@using Newtonsoft.Json
@using FinalProject.Models
@inject HttpClient Http


<head>
    <meta charset="UTF-8">
    <title>Banu's Google</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css" />
</head>
<body>
<header>
    <div class="left">
            <img src="./google.png" style="height: 35%; margin-right: 30px;" alt="">
        <div class="searchBar">
            <input id="searchQueryInput" type="text" name="searchQueryInput" placeholder="Search" @bind="query"/>
            <button id="searchQuerySubmit" type="submit" @onclick="Search"  name="searchQuerySubmit">
              <svg style="width:24px;height:24px" viewBox="0 0 24 24"><path fill="#666666" d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" />
              </svg>
            </button>
          </div>
    </div>
    <div class="right">
    </div>
</header>

<div class="wrapper">
    <input type="radio" name="slider" checked id="home">
    <input type="radio" name="slider" id="blog">
    <input type="radio" name="slider" id="code">
    <input type="radio" name="slider" id="help">
    <nav>
        <label for="home" class="home"><i class="fas fa-search"></i>Search</label>
        <label for="blog" class="blog"><i class="fas fa-image"></i>Images</label>
        <label for="code" class="code"><i class="fas fa-video"></i>Videos</label>
        <label for="help" class="help"><i class="fas fa-newspaper"></i>PDFy</label>
        <div class="slider"></div>
    </nav>
    <hr />
    <section>
        <div class="content content-1">

                @if (results != null)
                {
                    <ul>
                        @foreach (var result in results.Items)
                        {
                            <li style="list-style-type: none;">
                                <a href="@result.Link" style="text-decoration:none;">@result.Title</a><br>
                                <a href="@result.Link" style="color:green; font-size:16; text-decoration:none;">@result.Link</a>
                                <p style="font-size:13px; color:gray;">@result.Snippet</p>
                            </li>
                        }
                    </ul>
                }
        </div>
        <div class="content content-2">

                @if (results != null)
                {

                    <div class="row shadow-sm" style=" background-color:aliceblue; border-radius:20px; padding: 30px;">
                        @foreach (var result in imageResults.Items)
                        {
                            <div class="col-sm-12 col-md-6 col-lg-4" style="overflow-x:hidden; border-radius:10px;">
                                <div class="image-list" style="margin-bottom:30px; margin-right:5px;">
                                <img src="@result.Link" alt="@result.Title" style="height:250px; width:auto; margin-bottom:20px; border-radius:10px;"/>
                                <br>
                                <a href="@result.Link" style="font-size:16; margin-bottom:20px; text-decoration:none;">@result.Title</a>
                                </div>
                            </div>
                        }
                    </div>
                }
        </div>
        <div class="content content-3">
                @if (videos == null)
                {
                    <p>Loading...</p>
                }
                else
                {
                    <div class="row" style="margin-left:3%; margin-right:2%;">
                        @foreach (var video in videos.Items)
                        {
                            <div class="col-md-4">
                                <div class="card mb-4 shadow-sm">
                                    <img src="@video.snippet.thumbnails.medium.url" alt="@video.snippet.title" class="bd-placeholder-img card-img-top" width="100%" height="225" />
                                    <div class="card-body">
                                        <h5>@video.snippet.title</h5>
                                        <p class="card-text">@video.snippet.description</p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div class="btn-group">
                                                <a href="@($"https://www.youtube.com/watch?v={video.id.videoId}")" target="_blank" class="btn btn-sm btn-outline-secondary">View</a>
                                            </div>
                                            <small class="text-muted">@video.snippet.publishedAt.ToShortDateString()</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }

                        <div class="btn-group mr-2 d-flex align-items-center" role="group" aria-label="Second group">
                            @if (!string.IsNullOrEmpty(prevPageToken))
                            {
                                <button class="btn btn-secondary btn-block" disabled=@IsDisabled @onclick="PrevPage">Previous Page</button>
                            }
                            @if (!string.IsNullOrEmpty(videos.NextPageToken))
                            {
                                <button class="btn btn-primary btn-block" @onclick="NextPage">Next Page</button>
                            }
                        </div>
                        
                    </div>
            }
        </div>
        <div class="content content-4">
            <div class="title">PDFy</div>
            <p>Download a summarized document about all the information of this particular search as a pdf. Click the button below.</p>
        </div>
    </section>
</div>


</body>

@code {
    private string query;
    private string nextPageToken;
    private string prevPageToken;
    private bool IsDisabled =true;
    private GoogleSearchResults results;
    private GoogleSearchResults imageResults;
    private YouTubeSearchResults videos;

    private async Task Search()
    {
        var apiKey = "AIzaSyCiIEeRSk2UpSerxGxStHL27X0YMBbi0LE ";
        var searchEngineId = "44b128b3a85a3465e";
        var response = await Http.GetFromJsonAsync<GoogleSearchResults>($"https://www.googleapis.com/customsearch/v1?key={apiKey}&cx={searchEngineId}&q={query}");
        results = response;

        response = await Http.GetFromJsonAsync<GoogleSearchResults>($"https://www.googleapis.com/customsearch/v1?key={apiKey}&cx={searchEngineId}&q={query}&searchType=image");
        imageResults = response;

        var url = $"https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=9&q={query}&key=AIzaSyBHXprpxe_e-zU42QcDo_VXkxzOwBEW1wQ";
        var responseV = await Http.GetFromJsonAsync<YouTubeSearchResults>(url);
        videos = responseV;
        nextPageToken = videos.NextPageToken;
        IsDisabled = false;
    }

    private async Task NextPage()
    {
        videos = await Http.GetFromJsonAsync<YouTubeSearchResults>($"https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=9&pageToken={nextPageToken}&q={query}&key=AIzaSyBHXprpxe_e-zU42QcDo_VXkxzOwBEW1wQ");
        nextPageToken = videos.NextPageToken;
        prevPageToken = videos.PrevPageToken;
        IsDisabled = false;
    }
    private async Task PrevPage()
    {
        videos = await Http.GetFromJsonAsync<YouTubeSearchResults>($"https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=9&pageToken={prevPageToken}&q={query}&key=AIzaSyBHXprpxe_e-zU42QcDo_VXkxzOwBEW1wQ");
        nextPageToken = videos.NextPageToken;
        prevPageToken = videos.PrevPageToken;
    }

}